<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ü§ñ AI GitHub Admin</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* –®–∞–ø–∫–∞ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .header h1 {
      color: #58a6ff;
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .badge {
      background: #238636;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
    }

    .secure-badge {
      background: #1f6feb;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
    }

    .card h2 {
      color: #58a6ff;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä */
    .file-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #30363d;
      border-radius: 6px;
      margin-bottom: 15px;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #30363d;
      cursor: pointer;
    }

    .file-item:hover {
      background: #21262d;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-name {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
    }

    .file-actions {
      display: flex;
      gap: 5px;
    }

    /* –§–æ—Ä–º—ã */
    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #8b949e;
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 8px 12px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #c9d1d9;
      font-family: inherit;
      font-size: 14px;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
      font-family: 'Monaco', 'Menlo', monospace;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #58a6ff;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .button {
      background: #238636;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .button:hover {
      background: #2ea043;
    }

    .button.secondary {
      background: #21262d;
      color: #c9d1d9;
    }

    .button.secondary:hover {
      background: #30363d;
    }

    .button.small {
      padding: 4px 8px;
      font-size: 12px;
    }

    /* –ß–∞—Ç —Å AI */
    .chat-container {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      margin-top: 20px;
    }

    .chat-header {
      padding: 15px 20px;
      border-bottom: 1px solid #30363d;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h2 {
      color: #58a6ff;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .messages {
      height: 300px;
      overflow-y: auto;
      padding: 20px;
      background: #0d1117;
    }

    .message {
      margin-bottom: 15px;
      padding: 10px 15px;
      border-radius: 8px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .user-message {
      background: #1f6feb;
      color: white;
      margin-left: auto;
    }

    .ai-message {
      background: #21262d;
      color: #c9d1d9;
    }

    .system-message {
      background: #30363d;
      color: #8b949e;
      text-align: center;
      margin: 10px auto;
      font-style: italic;
      max-width: 100%;
    }

    .chat-input {
      display: flex;
      gap: 10px;
      padding: 20px;
      border-top: 1px solid #30363d;
    }

    .chat-input textarea {
      flex: 1;
      min-height: 60px;
      margin-bottom: 0;
    }

    /* –°—Ç–∞—Ç—É—Å—ã */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #58a6ff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .status.success { background: #238636; }
    .status.pending { background: #9e6a03; }
    .status.error { background: #da3633; }

    /* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */
    .preview {
      margin-top: 15px;
      padding: 15px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }

    /* –¢–∞–±—ã */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      border-bottom: 1px solid #30363d;
      padding-bottom: 10px;
    }

    .tab {
      padding: 5px 15px;
      cursor: pointer;
      border-radius: 20px;
      font-size: 14px;
    }

    .tab.active {
      background: #1f6feb;
      color: white;
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
    .info-box {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 10px;
      margin-top: 10px;
      font-size: 13px;
      color: #8b949e;
    }

    .info-box code {
      background: #161b22;
      padding: 2px 5px;
      border-radius: 4px;
      color: #58a6ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
      <h1>
        <span>ü§ñ AI GitHub Admin</span>
        <span class="badge">v2.0</span>
      </h1>
      <div class="secure-badge">
        <span>üîí</span>
        <span>–¢–æ–∫–µ–Ω—ã –≤ GitHub Secrets</span>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ -->
    <div class="grid">
      <!-- –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä -->
      <div class="card">
        <h2>üìÅ –§–∞–π–ª—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</h2>
        
        <!-- –¢–∞–±—ã -->
        <div class="tabs">
          <div class="tab active" onclick="switchTab('files')" id="tab-files">–í—Å–µ —Ñ–∞–π–ª—ã</div>
          <div class="tab" onclick="switchTab('create')" id="tab-create">‚ûï –°–æ–∑–¥–∞—Ç—å</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ñ–∞–π–ª–æ–≤ -->
        <div id="files-tab">
          <div class="file-list" id="fileList">
            <div class="file-item">
              <span class="file-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
          </div>
          <button class="button secondary small" onclick="loadFiles()" style="margin-top: 10px;">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
          </button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ -->
        <div id="create-tab" style="display: none;">
          <div class="form-group">
            <label>–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É</label>
            <input type="text" id="newFilePath" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: docs/readme.md">
          </div>
          <div class="form-group">
            <label>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</label>
            <textarea id="newFileContent" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞..."></textarea>
          </div>
          <div class="form-group">
            <label>Commit message</label>
            <input type="text" id="newFileMessage" value="AI: —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞">
          </div>
          <button class="button" onclick="createNewFile()">üìÑ –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª</button>
          <button class="button secondary" onclick="previewContent()" style="margin-left: 10px;">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
          
          <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
          <div id="preview" class="preview" style="display: none;"></div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="info-box">
          <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ù–∞–∂–º–∏ –Ω–∞ —Ñ–∞–π–ª —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        </div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="card">
        <h2>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        
        <div class="form-group">
          <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</label>
          <select id="quickAction">
            <option value="list">üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã</option>
            <option value="read">üìñ –ü—Ä–æ—á–∏—Ç–∞—Ç—å tasks.json</option>
            <option value="read-log">üìä –ü–æ–∫–∞–∑–∞—Ç—å worker.log</option>
            <option value="create-task">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –≤ tasks.json</option>
            <option value="run-worker">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å worker</option>
          </select>
        </div>
        
        <button class="button" onclick="runQuickAction()" style="width: 100%;">
          üöÄ –í—ã–ø–æ–ª–Ω–∏—Ç—å
        </button>

        <div style="margin-top: 20px;">
          <h3 style="color: #8b949e; font-size: 14px; margin-bottom: 10px;">üìå –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:</h3>
          <div class="info-box" style="cursor: pointer;" onclick="setExample(1)">
            "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª test.txt —Å —Ç–µ–∫—Å—Ç–æ–º 'Hello World'"
          </div>
          <div class="info-box" style="cursor: pointer; margin-top: 5px;" onclick="setExample(2)">
            "–û–±–Ω–æ–≤–∏ index.html, –¥–æ–±–∞–≤—å –∫—Ä–∞—Å–∏–≤—É—é –∫–Ω–æ–ø–∫—É"
          </div>
          <div class="info-box" style="cursor: pointer; margin-top: 5px;" onclick="setExample(3)">
            "–ü–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ worker.log"
          </div>
        </div>
      </div>
    </div>

    <!-- AI –ß–∞—Ç -->
    <div class="chat-container">
      <div class="chat-header">
        <h2>
          <span>üß† AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç (OpenRouter)</span>
          <span class="status success">online</span>
        </h2>
        <div>
          <button class="button secondary small" onclick="clearChat()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>

      <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
      <div class="messages" id="chatMessages">
        <div class="message system-message">
          üîí –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ GitHub Actions. –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Secrets.
        </div>
        <div class="message system-message">
          üí¨ –ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä: "—Å–æ–∑–¥–∞–π —Ñ–∞–π–ª hello.txt"
        </div>
      </div>

      <!-- –í–≤–æ–¥ -->
      <div class="chat-input">
        <textarea 
          id="userInput" 
          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å... (Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)"
          onkeydown="handleKeyDown(event)"
        ></textarea>
        <button class="button" onclick="sendToAI()" style="align-self: flex-end;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const REPO_OWNER = 'artemis1987';
    const REPO_NAME = 'Privet-mir';
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let currentMessages = [
      { role: 'system', content: '–¢—ã AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è GitHub. –ü–æ–º–æ–≥–∞–π —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.' }
    ];
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function switchTab(tab) {
      document.getElementById('files-tab').style.display = tab === 'files' ? 'block' : 'none';
      document.getElementById('create-tab').style.display = tab === 'create' ? 'block' : 'none';
      
      document.getElementById('tab-files').className = tab === 'files' ? 'tab active' : 'tab';
      document.getElementById('tab-create').className = tab === 'create' ? 'tab active' : 'tab';
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
    async function loadFiles() {
      const fileList = document.getElementById('fileList');
      fileList.innerHTML = '<div class="file-item"><span class="file-name">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</span></div>';
      
      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º API GitHub –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/git/trees/main?recursive=1`);
        const data = await response.json();
        
        if (data.tree) {
          const files = data.tree.filter(item => item.type === 'blob');
          
          if (files.length === 0) {
            fileList.innerHTML = '<div class="file-item"><span class="file-name">üì≠ –§–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span></div>';
            return;
          }
          
          fileList.innerHTML = '';
          files.forEach(file => {
            const div = document.createElement('div');
            div.className = 'file-item';
            div.onclick = () => viewFile(file.path);
            div.innerHTML = `
              <span class="file-name">üìÑ ${file.path}</span>
              <span class="file-actions">
                <button class="button secondary small" onclick="event.stopPropagation(); viewFile('${file.path}')">üëÅÔ∏è</button>
                <button class="button secondary small" onclick="event.stopPropagation(); deleteFile('${file.path}')">üóëÔ∏è</button>
              </span>
            `;
            fileList.appendChild(div);
          });
        }
      } catch (error) {
        fileList.innerHTML = `<div class="file-item"><span class="file-name">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span></div>`;
      }
    }
    
    // –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞
    async function viewFile(path) {
      addMessage('user', `–ü–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: ${path}`);
      
      try {
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`);
        const data = await response.json();
        
        if (data.content) {
          const content = atob(data.content);
          addMessage('ai', `üìÑ **${path}**:\n\`\`\`\n${content.substring(0, 500)}${content.length > 500 ? '...' : ''}\n\`\`\``);
        }
      } catch (error) {
        addMessage('ai', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
      }
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ AI
    async function createNewFile() {
      const path = document.getElementById('newFilePath').value;
      const content = document.getElementById('newFileContent').value;
      const message = document.getElementById('newFileMessage').value;
      
      if (!path || !content) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ');
        return;
      }
      
      addMessage('user', `–°–æ–∑–¥–∞–π —Ñ–∞–π–ª ${path} —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:\n${content}`);
      
      await callAIThroughActions({
        action: 'create_file',
        path: path,
        content: content,
        message: message
      });
    }
    
    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
    function previewContent() {
      const content = document.getElementById('newFileContent').value;
      const preview = document.getElementById('preview');
      
      if (content) {
        preview.style.display = 'block';
        preview.textContent = content;
      } else {
        preview.style.display = 'none';
      }
    }
    
    // –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    async function runQuickAction() {
      const action = document.getElementById('quickAction').value;
      
      switch(action) {
        case 'list':
          await loadFiles();
          addMessage('system', 'üìã –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω');
          break;
        case 'read':
          await viewFile('tasks.json');
          break;
        case 'read-log':
          await viewFile('worker.log');
          break;
        case 'create-task':
          document.getElementById('newFilePath').value = 'tasks.json';
          document.getElementById('newFileContent').value = '[\n  {\n    "target_file": "test.log",\n    "content": "—Ç–µ—Å—Ç",\n    "status": "pending"\n  }\n]';
          switchTab('create');
          break;
        case 'run-worker':
          addMessage('user', '–ó–∞–ø—É—Å—Ç–∏ worker');
          await callAIThroughActions({
            action: 'run_action',
            workflow: 'worker.yml'
          });
          break;
      }
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–º–µ—Ä–∞
    function setExample(num) {
      const examples = {
        1: "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª test.txt —Å —Ç–µ–∫—Å—Ç–æ–º 'Hello World'",
        2: "–û–±–Ω–æ–≤–∏ index.html, –¥–æ–±–∞–≤—å –∫—Ä–∞—Å–∏–≤—É—é –∫–Ω–æ–ø–∫—É —Å —Ç–µ–∫—Å—Ç–æ–º '–ù–∞–∂–º–∏ –º–µ–Ω—è'",
        3: "–ü–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ worker.log"
      };
      document.getElementById('userInput').value = examples[num];
    }
    
    // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
    function clearChat() {
      document.getElementById('chatMessages').innerHTML = `
        <div class="message system-message">üîí –ß–∞—Ç –æ—á–∏—â–µ–Ω</div>
        <div class="message system-message">üí¨ –ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å</div>
      `;
      currentMessages = [
        { role: 'system', content: '–¢—ã AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è GitHub. –ü–æ–º–æ–≥–∞–π —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É.' }
      ];
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ AI
    async function sendToAI() {
      const userInput = document.getElementById('userInput').value;
      if (!userInput.trim()) return;
      
      addMessage('user', userInput);
      document.getElementById('userInput').value = '';
      
      currentMessages.push({ role: 'user', content: userInput });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      const loadingId = addMessage('ai', '<div class="loading"></div> AI –¥—É–º–∞–µ—Ç —á–µ—Ä–µ–∑ GitHub Actions...');
      
      try {
        // –°–Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ OpenRouter
        const analysisResult = await callAIThroughActions({
          action: 'chat',
          data: {
            messages: [
              { 
                role: 'system', 
                content: `–¢—ã AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–µ—Ä–Ω–∏ JSON —Å –¥–µ–π—Å—Ç–≤–∏–µ–º.
                
–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–õ–¨–ö–û JSON:

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
{"action":"create_file","path":"–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É","content":"—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ","message":"commit message"}

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª:
{"action":"update_file","path":"–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É","content":"–Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ","message":"commit message"}

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª:
{"action":"read_file","path":"–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É"}

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å action:
{"action":"run_action","workflow":"worker.yml"}

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å:
{"action":"chat","response":"—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞"}

–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userInput}`
              }
            ]
          }
        });
        
        // –£–¥–∞–ª—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        document.getElementById(loadingId)?.remove();
        
        // –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
        if (analysisResult && analysisResult.choices && analysisResult.choices[0]) {
          const content = analysisResult.choices[0].message.content;
          
          try {
            // –ò—â–µ–º JSON –≤ –æ—Ç–≤–µ—Ç–µ
            const jsonMatch = content.match(/\{.*\}/s);
            if (jsonMatch) {
              const command = JSON.parse(jsonMatch[0]);
              
              if (command.action === 'chat') {
                addMessage('ai', command.response);
                currentMessages.push({ role: 'assistant', content: command.response });
              } else {
                // –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ GitHub
                await callAIThroughActions(command);
              }
            } else {
              // –ï—Å–ª–∏ –Ω–µ JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
              addMessage('ai', content);
              currentMessages.push({ role: 'assistant', content: content });
            }
          } catch (e) {
            // –ï—Å–ª–∏ –Ω–µ JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            addMessage('ai', content);
            currentMessages.push({ role: 'assistant', content: content });
          }
        }
        
      } catch (error) {
        document.getElementById(loadingId)?.remove();
        addMessage('ai', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
      }
    }
    
    // –í—ã–∑–æ–≤ AI —á–µ—Ä–µ–∑ GitHub Actions
    async function callAIThroughActions(command) {
      return new Promise((resolve, reject) => {
        // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        const requestId = Date.now() + '-' + Math.random().toString(36);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º workflow
        fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/actions/workflows/ai-proxy.yml/dispatches`, {
          method: 'POST',
          headers: {
            'Accept': 'application/vnd.github.v3+json',
            'Authorization': 'Bearer ' + prompt('–í–≤–µ–¥–∏—Ç–µ GitHub —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Actions:', 'ghp_')
          },
          body: JSON.stringify({
            ref: 'main',
            inputs: {
              action: command.action || 'chat',
              data: JSON.stringify(command.data || command)
            }
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          
          // –ñ–¥–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (5 —Å–µ–∫—É–Ω–¥)
          setTimeout(() => checkWorkflowResult(requestId, resolve, reject), 3000);
        })
        .catch(reject);
      });
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ workflow
    async function checkWorkflowResult(requestId, resolve, reject) {
      try {
        // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/actions/runs?per_page=5`);
        const data = await response.json();
        
        if (data.workflow_runs && data.workflow_runs.length > 0) {
          const lastRun = data.workflow_runs[0];
          
          // –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–∏
          const logsResponse = await fetch(lastRun.logs_url);
          const logs = await logsResponse.text();
          
          // –ò—â–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
          const aiMatch = logs.match(/=== AI_RESPONSE START ===\n(.*?)\n=== AI_RESPONSE END ===/s);
          const fileMatch = logs.match(/=== FILE_RESULT START ===\n(.*?)\n=== FILE_RESULT END ===/s);
          const contentMatch = logs.match(/=== FILE_CONTENT START ===\n(.*?)\n=== FILE_CONTENT END ===/s);
          const errorMatch = logs.match(/=== ERROR START ===\n(.*?)\n=== ERROR END ===/s);
          
          if (aiMatch) {
            const result = JSON.parse(aiMatch[1]);
            resolve(result);
          } else if (fileMatch) {
            const result = JSON.parse(fileMatch[1]);
            if (result.success) {
              addMessage('ai', `‚úÖ –§–∞–π–ª ${result.path} —É—Å–ø–µ—à–Ω–æ ${result.action === 'create_file' ? '—Å–æ–∑–¥–∞–Ω' : '–æ–±–Ω–æ–≤–ª–µ–Ω'}`);
              loadFiles(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
            } else {
              addMessage('ai', `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(result.result)}`);
            }
            resolve(result);
          } else if (contentMatch) {
            const data = JSON.parse(contentMatch[1]);
            addMessage('ai', `üìÑ **${data.path}**:\n\`\`\`\n${data.content}\n\`\`\``);
            resolve(data);
          } else if (errorMatch) {
            const error = JSON.parse(errorMatch[1]);
            addMessage('ai', `‚ùå –û—à–∏–±–∫–∞: ${error.error}`);
            reject(error);
          } else {
            addMessage('ai', '‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)');
            resolve(null);
          }
        }
      } catch (error) {
        reject(error);
      }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function addMessage(type, text) {
      const messages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}-message`;
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
      let formattedText = text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>');
      
      messageDiv.innerHTML = formattedText;
      messages.appendChild(messageDiv);
      messages.scrollTop = messages.scrollHeight;
      
      return messageDiv.id;
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter
    function handleKeyDown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendToAI();
      }
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    async function deleteFile(path) {
      if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª ${path}?`)) return;
      
      addMessage('user', `–£–¥–∞–ª–∏ —Ñ–∞–π–ª ${path}`);
      
      // –ó–¥–µ—Å—å –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
      alert('–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitHub API —Å —Ç–æ–∫–µ–Ω–æ–º');
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    window.onload = () => {
      loadFiles();
    };
  </script>
</body>
</html>
