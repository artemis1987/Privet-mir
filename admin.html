<!DOCTYPE html>
<html>
<head>
    <title>ü§ñ AI GitHub Admin</title>
    <style>
        body { background: #0d1117; color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        .card { background: #161b22; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        textarea, input { width: 100%; padding: 10px; margin: 10px 0; background: #0d1117; color: white; border: 1px solid #30363d; }
        button { background: #238636; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
        .flex { display: flex; gap: 10px; flex-wrap: wrap; }
        .message { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .ai { background: #21262d; }
        .success { color: #2ea043; }
        .file-item { padding: 8px; background: #0d1117; margin: 5px 0; cursor: pointer; border: 1px solid #30363d; }
        .file-item:hover { background: #21262d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2>ü§ñ AI GitHub Admin</h2>
            <p class="success">üîí –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
            
            <input type="password" id="ghToken" placeholder="GitHub —Ç–æ–∫–µ–Ω (ghp_...)" value="">
            <input type="password" id="orToken" placeholder="OpenRouter –∫–ª—é—á" value="">
            <button onclick="saveTokens()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã</button>
        </div>

        <div class="card">
            <div class="flex">
                <button onclick="listFiles()">üìã –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤</button>
                <button onclick="runWorkflow('test')">üîÑ –¢–µ—Å—Ç workflow</button>
                <button onclick="deploySite()">üöÄ –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å–∞–π—Ç</button>
            </div>
            <div id="fileList"></div>
        </div>

        <div class="card">
            <h3>ü§ñ AI –ö–æ–º–∞–Ω–¥—ã</h3>
            <textarea id="aiInput" rows="3" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å..."></textarea>
            <button onclick="aiCommand()">üöÄ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
            <div id="aiResponse" class="message ai"></div>
        </div>

        <div class="card">
            <h3>üìÅ –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª</h3>
            <input id="fileName" placeholder="–ò–º—è —Ñ–∞–π–ª–∞">
            <textarea id="fileContent" rows="5" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ"></textarea>
            <button onclick="createFile()">‚úÖ –°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>

    <script>
        const REPO = 'artemis1987/Privet-mir';
        
        function saveTokens() {
            localStorage.setItem('gh_token', document.getElementById('ghToken').value);
            localStorage.setItem('or_token', document.getElementById('orToken').value);
            alert('‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function getToken() {
            return localStorage.getItem('gh_token') || document.getElementById('ghToken').value;
        }

        function getOR() {
            return localStorage.getItem('or_token') || document.getElementById('orToken').value;
        }

        // AI –°–ê–ú –í–°–ï –î–ï–õ–ê–ï–¢
        async function aiCommand() {
            const text = document.getElementById('aiInput').value;
            if (!text) return;
            
            const orKey = getOR();
            if (!orKey) { alert('–í–≤–µ–¥–∏ OpenRouter –∫–ª—é—á'); return; }
            
            document.getElementById('aiResponse').innerHTML = '‚è≥ AI –¥—É–º–∞–µ—Ç...';
            
            try {
                // AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É
                const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${orKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [{
                            role: 'system',
                            content: '–¢—ã AI –∞–¥–º–∏–Ω. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É –∏ –æ—Ç–≤–µ—á–∞–π JSON. –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: create_file, update_file, delete_file, deploy, run_workflow, list_files'
                        }, {
                            role: 'user',
                            content: text
                        }]
                    })
                });
                
                const data = await res.json();
                const answer = data.choices[0].message.content;
                
                // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
                if (answer.includes('create_file') || text.includes('—Å–æ–∑–¥–∞–π')) {
                    const fileName = prompt('–ò–º—è —Ñ–∞–π–ª–∞:', 'test.txt');
                    const content = prompt('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:', 'Hello World');
                    if (fileName && content) {
                        await createFile(fileName, content);
                        document.getElementById('aiResponse').innerHTML = '‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω!';
                    }
                }
                else if (answer.includes('deploy') || text.includes('–¥–µ–ø–ª–æ–π')) {
                    await deploySite();
                    document.getElementById('aiResponse').innerHTML = 'üöÄ –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω!';
                }
                else if (answer.includes('list') || text.includes('—Å–ø–∏—Å–æ–∫')) {
                    await listFiles();
                    document.getElementById('aiResponse').innerHTML = 'üìã –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω';
                }
                else {
                    document.getElementById('aiResponse').innerHTML = `ü§ñ ${answer}`;
                }
                
            } catch (e) {
                document.getElementById('aiResponse').innerHTML = `‚ùå ${e.message}`;
            }
        }

        // –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
        async function listFiles() {
            const token = getToken();
            if (!token) { alert('–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞'); return; }
            
            const res = await fetch(`https://api.github.com/repos/${REPO}/git/trees/main?recursive=1`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await res.json();
            let html = '';
            data.tree?.forEach(item => {
                if (item.type === 'blob') {
                    html += `<div class="file-item" onclick="viewFile('${item.path}')">üìÑ ${item.path}</div>`;
                }
            });
            document.getElementById('fileList').innerHTML = html;
        }

        async function viewFile(path) {
            const token = getToken();
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const data = await res.json();
            document.getElementById('fileContent').value = atob(data.content);
            document.getElementById('fileName').value = path;
        }

        async function createFile(name, content) {
            const token = getToken();
            const fileName = name || document.getElementById('fileName').value;
            const fileContent = content || document.getElementById('fileContent').value;
            
            const check = await fetch(`https://api.github.com/repos/${REPO}/contents/${fileName}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            let sha = null;
            if (check.ok) {
                const data = await check.json();
                sha = data.sha;
            }
            
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${fileName}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'AI: ' + fileName,
                    content: btoa(unescape(encodeURIComponent(fileContent))),
                    branch: 'main',
                    sha: sha
                })
            });
            
            if (res.ok) alert('‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω!');
        }

        // –î–µ–ø–ª–æ–π
        async function deploySite() {
            const token = getToken();
            await fetch(`https://api.github.com/repos/${REPO}/pages/builds`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            alert('üöÄ –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω! –ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É —Å–∞–π—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è');
        }

        // –ó–∞–ø—É—Å–∫ workflow
        async function runWorkflow(action) {
            const token = getToken();
            await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/ai-proxy.yml/dispatches`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    ref: 'main',
                    inputs: { action: action, data: '{}' }
                })
            });
            alert('‚úÖ Workflow –∑–∞–ø—É—â–µ–Ω');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
        document.getElementById('ghToken').value = localStorage.getItem('gh_token') || '';
        document.getElementById('orToken').value = localStorage.getItem('or_token') || '';
    </script>
</body>
</html>
